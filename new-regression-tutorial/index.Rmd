---
title: "The Idea of Regression"
subtitle: "New Regression Tutorial"
author: "Andy Grogan-Kaylor"
date: "`r Sys.Date()`"
output: 
  tint::tintHtml:
    number_sections: yes
    toc: yes
    highlight: haddock
  tint::tintPdf:
    number_sections: yes
    toc: no
    highlight: haddock
---

```{r setup, include=FALSE}

library(tint)

# invalidate cache when the package version changes

knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      tidy = FALSE, 
                      cache.extra = packageVersion('tint'))

options(htmltools.dir.version = FALSE)

```

```{r}

library(ggplot2) # beautiful graphs

library(gganimate) # animated beautiful graphs

```

# Introduction

Somewhere along the way in a math class in elementary, middle or high school, you may have encountered the idea of graphing lines and thinking about the equations that represent those lines.  

# Imagine A Single Runner

Let’s think about this idea using the hypothetical example of several runners.

The <font color="orange">orange</font> line represents a runner who runs 6 miles every hour.  In 2 hours, this person will have run 12 miles, and if that runner continued for 3 hours of running, they would run 18 miles.

```{r, fig.margin = TRUE}

x1 <- c(0, 1, 2, 3)

y1 <- 6 * x1

mydata <- data.frame(x1,y1)

p1 <- ggplot(data = mydata,
            aes(x = x1,
                y = y1,
                group = 1)) +
  geom_point(color = "orange",
             size = 10) + 
  geom_line(color = "orange",
            size = 2) + 
  # geom_label(aes(label = paste("hours", 
  #                              round(x, digits = 2),
  #                              "\n",
  #                              "distance: ",
  #                              round(y, digits = 2)))) +
  labs(title = "Distance as a Function of Time",
       x = "Hours",
       y = "Distance") +
  theme(title = element_text(size = rel(2)),
        axis.text = element_text(size = rel(2))) +
  transition_reveal(x1)

p1 # replay graph

```

We can write an equation that represents the distance run in several equivalent ways:

$distance = 6 * time$

$miles = 6 * hours$

$y = 6* x$

In this case, the runner’s speed (6 miles per hour) is what we call the *slope* of the line. The <font color="orange">orange</font> runner is getting 6 miles of distance for every hour spent running.  Economists sometimes talk about this idea as the “rate of return”:  For every hour of running, the <font color="orange">orange</font> runner gets 6 miles of distance.  

# Imagine Two Additional Runners

Imagine now two other runners, represented by a <font color="red">red</font> line and a <font color="blue">blue</font> line.  

```{r, fig.margin = TRUE}

x2 <- rep(c(0, 1, 2, 3), 3)

slope2 <- rep(c(6, 3, 6), each= 4)

intercept2 <- rep(c(0, 0, 2), each = 4)

runner <- rep(c("orange", "red", "blue"), each = 4)

y2 <- intercept2 + slope2 * x2

mydata2 <- data.frame(runner, x2, slope2, intercept2, y2)

p2 <- ggplot(data = mydata2,
            aes(x = x2,
                y = y2,
                color = runner,
                group = runner)) +
  geom_point(size = 10) + 
  geom_line(size = 2) + 
  labs(title = "Distance as a Function of Time",
       x = "Hours",
       y = "Distance") +
  scale_color_manual(values = c("blue",
                                "orange",
                                "red")) +
  theme(title = element_text(size = rel(2)),
        axis.text = element_text(size = rel(2))) +
  transition_reveal(x2)

p2 # replay graph


```


The <font color="red">red</font> runner starts at the same place as the <font color="orange">orange</font> runner, but runs at a slower 3 mile per hour pace.  We can say that the *slope* of the <font color="red">red</font> runner’s line is flatter than the line for the orange runner.  In fact, this *slope* is 3 miles per hour.

The <font color="blue">blue</font> runner’s situation is somewhat different.  The <font color="blue">blue</font> runner runs at the same speed as the <font color="orange">orange</font> runner. We can say that their lines on the graph have the same *slope*. 

But after two hours of running, the <font color="blue">blue</font> runner is further along because the <font color="blue">blue</font> runner started 2 miles ahead of the <font color="orange">orange</font> runner.  We need a new term to describe this idea.  In graphing, and in statistics, we say that the <font color="blue">blue</font> runner’s line intercepts the y axis at a higher point than the line for the <font color="orange">orange</font> runner.  Put another way, the <font color="blue">blue</font> runner has a higher y-intercept than the <font color="orange">orange</font> runner.  

These two concepts of the *slope* and the *y-intercept* are the foundations of the idea of regression.

# A New Example With More Runners

Let’s stick with the hypothetical example of runners, but now let’s imagine a slightly different situation.  Imagine  that we have data on how far several different runners have run, and we want to find the average speed of these runners. (you could also think this as the average rate of change of distance over time.)

```{r, fig.margin = TRUE}

library(haven)

runners <- read_dta("runners.dta")

runners$runner <- factor(runners$runner)

fit <- lm(miles ~ hours, data = runners)

runners$yhat <- fitted.values(fit)

p3 <- ggplot(runners,
             aes(x = hours,
                 y = miles)) +
  geom_point(aes(color = runner),
             size = 10) +
  labs(title = "Distance Run by Time Spent Running",
       x = "Hours",
       y = "Distance") +
  theme(title = element_text(size = rel(1.5)),
        axis.text = element_text(size = rel(1.5)))  

p3 # + 
  # transition_manual(hours, cumulative = TRUE)

```

I want to draw the line that best fits these data to get a sense of on average, how fast runners run.

```{r, fig.margin = TRUE}

p3 + 
  geom_line(aes(y = yhat),
            size = 2,
            color = "blue") + 
  transition_reveal(hours)

```


My guess is drawn as a <font color="blue">blue</font> line.

I could even make a guess about the *slope* which represents the average speed:  How far does the distance go up for every mile that is run, on average?  

